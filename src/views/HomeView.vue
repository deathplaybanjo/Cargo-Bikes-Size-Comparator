<template>
  <div class="_homeView">
    <SideBar
      :bikes="bikes"
      :enabled_bikes="enabled_bikes"
      :grid_step="grid_step"
      v-model:default_padding_percent="default_padding_percent"
      v-model:grid_step="grid_step"
      v-model:bikes_position_adjustments="bikes_position_adjustments"
      :canvas_image_style_outline="canvas_image_style_outline"
      @showAddBikeModal="add_bike_modal = true"
    />
    <CanvasView
      :enabled_bikes="enabled_bikes"
      :default_padding_percent="default_padding_percent"
      :grid_step="grid_step"
      :bikes_position_adjustments="bikes_position_adjustments"
      v-model:canvas_image_style_outline="canvas_image_style_outline"
    />
    <transition name="fade" mode="out-in">
      <AddBikeModal v-if="add_bike_modal" :bikes="bikes" @close="add_bike_modal = false" />
    </transition>
  </div>
</template>
<script>
import SideBar from '@/components/SideBar.vue'
import CanvasView from '@/components/CanvasView.vue'
import AddBikeModal from '@/components/AddBikeModal.vue'

export default {
  props: {
    bikes: Array
  },
  components: {
    SideBar,
    CanvasView,
    AddBikeModal
  },
  data() {
    return {
      ro: null,

      add_bike_modal: false,

      default_padding_percent: 5,
      canvas_image_style_outline: false,
      grid_step: 20,

      bikes_position_adjustments: {},

      bike_outline_colors: ['3333ff', 'ff0000', '11bb11', 'bbbb00', 'ff00ff', '00bbbb']
    }
  },
  created() {},
  async mounted() {},
  beforeUnmount() {},
  watch: {},
  computed: {
    enabled_bikes_ids() {
      if (this.$route.query.bikes) {
        try {
          return JSON.parse(this.$route.query.bikes)
        } catch (e) {
          return []
        }
      }
      return []
    },
    enabled_bikes() {
      return this.enabled_bikes_ids.reduce((acc, id, index) => {
        const bike = this.findMatchingBike(id)
        if (bike) {
          const color_options = this.bike_outline_colors
          bike.color = color_options[index % color_options.length]
          acc.push(bike)
        }
        return acc
      }, [])
    }
  },
  methods: {
    findMatchingBike(id) {
      return this.bikes.find((i) => i.id === id)
    }
  }
}
</script>
<style lang="scss" scoped>
._homeView {
  display: flex;
  flex-flow: row nowrap;
  height: 100svh;
}
</style>
